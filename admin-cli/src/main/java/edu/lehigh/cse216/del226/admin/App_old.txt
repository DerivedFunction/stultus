package edu.lehigh.cse216.del226.admin;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;
import java.util.Map;

/**
 * App is the basic admin app. For now, all it does it connect to database
 * and then disconnect
 */
public class App_old {
  /**
   * The main routine reads args from env and then uses them to connect to
   * database.
   * POSTGRES_IP=salt.db.elephantsql.com POSTGRES_PORT=5432 POSTGRES_USER=zpkehcqe POSTGRES_PASS=oejIxbtHsybJMhWYF4NWJ_VJPA50z2bJ mvn exec:java
   * */
  public static void main(String[] args) {
    // Get the Postgress config from the env
    Map<String, String> env = System.getenv();
    String ip = env.get("POSTGRES_IP"); // salt.db.elephantsql.com
    String port = env.get("POSTGRES_PORT"); // 5432
    String user = env.get("POSTGRES_USER"); // zpkehcqe
    String pass = env.get("POSTGRES_PASS"); // oejIxbtHsybJMhWYF4NWJ_VJPA50z2bJ

    // May need to get postgres driver to load
    try {
      Class.forName("org.postgresql.Driver");
    } catch (ClassNotFoundException cnfe) {
      System.out.println("Unable to find postgresql driver");
      return;
    }

    // connection to the database. In this example it is a local variable
    // although realistically it might not be.
    Connection conn = null;

    // Connect to database or fail
    System.out.print("Connecting to " + ip + ":" + port);
    try {
      // Open a connection, fail otherwise
      conn = DriverManager.getConnection(
          "jdbc:postgresql://" + ip + ":" + port + "/", user, pass);
      if (conn == null) {
        System.out.println(
            "\n\tError: DriverManager.getConnection() returned a null object");
      }
    } catch (SQLException e) {
      System.out.println(
          "\n\tError: DriverManager.getConnection() threw a SQLException");
      e.printStackTrace();
      return;
    }
    System.out.println(" ... successfully connectioned");
    System.out.print("Disconnecting from database");
    try {
      conn.close();
    } catch (SQLException e) {
      System.out.println("\n\tError close() threw a SQLException");
      e.printStackTrace();
      return;
    }
    System.out.println("... connection successfully closed");
  }
}
